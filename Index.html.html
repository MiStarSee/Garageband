<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c3{background-color:#ffffff;max-width:540pt;padding:36pt 36pt 36pt 36pt}.c1{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c3 doc-content"><p class="c0"><span class="c2">&lt;!DOCTYPE html&gt;</span></p><p class="c0"><span class="c2">&lt;html lang=&quot;en&quot;&gt;</span></p><p class="c0"><span class="c2">&lt;head&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;meta charset=&quot;UTF-8&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;title&gt;Staff Wars - Note Identification Game&lt;/title&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot; crossorigin&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;style&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; body {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; font-family: &#39;Poppins&#39;, sans-serif;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #1a202c; /* Equivalent to Tailwind&#39;s gray-800 */</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; .game-container {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 100%;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max-width: 1000px;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; margin: auto;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #2d3748; /* gray-700 */</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-radius: 1rem;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; .btn {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transition: all 0.2s ease-in-out;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; .btn:hover {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transform: translateY(-2px);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 4px 8px rgba(0,0,0,0.2);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; .btn-option.selected {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #4299e1; /* blue-500 */</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color: white;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-color: #4299e1; /* blue-500 */</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; .note-button {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 50px;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; height: 50px;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; font-weight: 700;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; font-size: 1.25rem;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; canvas {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: #f7fafc; /* gray-100 */</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; border-radius: 0.5rem;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; #game-over-screen {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; background-color: rgba(45, 55, 72, 0.9);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;/style&gt;</span></p><p class="c0"><span class="c2">&lt;/head&gt;</span></p><p class="c0"><span class="c2">&lt;body class=&quot;text-white flex items-center justify-center min-h-screen p-4&quot;&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;div class=&quot;game-container p-6&quot;&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Settings Screen --&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;settings-screen&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h1 class=&quot;text-4xl font-bold text-center mb-6&quot;&gt;Staff Wars&lt;/h1&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p class=&quot;text-center text-gray-300 mb-8&quot;&gt;Configure your game and start practicing!&lt;/p&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Difficulty --&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;mb-6&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 class=&quot;text-xl font-semibold mb-3&quot;&gt;Difficulty&lt;/h2&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;difficulty-options&quot; class=&quot;grid grid-cols-3 gap-4&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-value=&quot;easy&quot; class=&quot;btn btn-option p-4 bg-gray-600 rounded-lg border-2 border-transparent&quot;&gt;Easy&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-value=&quot;medium&quot; class=&quot;btn btn-option p-4 bg-gray-600 rounded-lg border-2 border-transparent&quot;&gt;Medium&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-value=&quot;hard&quot; class=&quot;btn btn-option p-4 bg-gray-600 rounded-lg border-2 border-transparent&quot;&gt;Hard&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Clef --&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;mb-8&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 class=&quot;text-xl font-semibold mb-3&quot;&gt;Clef&lt;/h2&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;clef-options&quot; class=&quot;grid grid-cols-2 gap-4&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-value=&quot;treble&quot; class=&quot;btn btn-option p-4 bg-gray-600 rounded-lg border-2 border-transparent&quot;&gt;Treble&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-value=&quot;bass&quot; class=&quot;btn btn-option p-4 bg-gray-600 rounded-lg border-2 border-transparent&quot;&gt;Bass&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button id=&quot;start-game-btn&quot; class=&quot;btn w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-4 rounded-lg text-xl&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Start Game</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Game Screen --&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;game-screen&quot; class=&quot;hidden&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;flex justify-between items-center mb-4 text-2xl font-bold&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;Score: &lt;span id=&quot;score&quot;&gt;0&lt;/span&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;Level: &lt;span id=&quot;level&quot;&gt;1&lt;/span&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;Health: &lt;span id=&quot;health&quot;&gt;5&lt;/span&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;canvas id=&quot;staff-canvas&quot; width=&quot;952&quot; height=&quot;400&quot;&gt;&lt;/canvas&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;mt-4 flex justify-center gap-2 flex-wrap&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;A&quot; class=&quot;btn note-button bg-red-500 rounded-full&quot;&gt;A&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;B&quot; class=&quot;btn note-button bg-orange-500 rounded-full&quot;&gt;B&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;C&quot; class=&quot;btn note-button bg-yellow-500 text-black rounded-full&quot;&gt;C&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;D&quot; class=&quot;btn note-button bg-green-500 rounded-full&quot;&gt;D&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;E&quot; class=&quot;btn note-button bg-blue-500 rounded-full&quot;&gt;E&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;F&quot; class=&quot;btn note-button bg-indigo-500 rounded-full&quot;&gt;F&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button data-note=&quot;G&quot; class=&quot;btn note-button bg-purple-500 rounded-full&quot;&gt;G&lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Game Over Screen --&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;game-over-screen&quot; class=&quot;hidden absolute inset-0 bg-gray-800 bg-opacity-90 flex flex-col justify-center items-center&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 class=&quot;text-5xl font-bold mb-4&quot;&gt;Game Over&lt;/h2&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p class=&quot;text-2xl mb-2&quot;&gt;Final Score: &lt;span id=&quot;final-score&quot;&gt;0&lt;/span&gt;&lt;/p&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p class=&quot;text-2xl mb-8&quot;&gt;Level Reached: &lt;span id=&quot;final-level&quot;&gt;1&lt;/span&gt;&lt;/p&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button id=&quot;play-again-btn&quot; class=&quot;btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg&quot;&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Play Again</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;script&gt;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- DOM ELEMENTS ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const settingsScreen = document.getElementById(&#39;settings-screen&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const gameScreen = document.getElementById(&#39;game-screen&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const gameOverScreen = document.getElementById(&#39;game-over-screen&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const startGameBtn = document.getElementById(&#39;start-game-btn&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const playAgainBtn = document.getElementById(&#39;play-again-btn&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const canvas = document.getElementById(&#39;staff-canvas&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const ctx = canvas.getContext(&#39;2d&#39;);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- GAME STATE &amp; SETTINGS ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; let score, level, health, gameSettings, notesOnScreen, gameLoopId, noteSpawnInterval;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; let gameIsOver = true;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- NOTE DATA ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // Maps note name to its position as steps from a reference point.</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // A &quot;step&quot; is half a line space. 0 is the bottom line of the staff.</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const notePositions = {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // Bass Clef (G2 is bottom line)</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &#39;G2&#39;: 0, &#39;A2&#39;: 1, &#39;B2&#39;: 2, &#39;C3&#39;: 3, &#39;D3&#39;: 4, &#39;E3&#39;: 5, &#39;F3&#39;: 6, &#39;G3&#39;: 7, &#39;A3&#39;: 8, &#39;B3&#39;: 9,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // Treble Clef (E4 is bottom line)</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &#39;C4&#39;: -2, &#39;D4&#39;: -1, &#39;E4&#39;: 0, &#39;F4&#39;: 1, &#39;G4&#39;: 2, &#39;A4&#39;: 3, &#39;B4&#39;: 4,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; };</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; const allNotes = [&#39;G2&#39;, &#39;A2&#39;, &#39;B2&#39;, &#39;C3&#39;,&#39;D3&#39;,&#39;E3&#39;,&#39;F3&#39;,&#39;G3&#39;,&#39;A3&#39;,&#39;B3&#39;, &#39;C4&#39;,&#39;D4&#39;,&#39;E4&#39;,&#39;F4&#39;,&#39;G4&#39;,&#39;A4&#39;,&#39;B4&#39;];</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- EVENT LISTENERS ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; document.addEventListener(&#39;DOMContentLoaded&#39;, init);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function init() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; setupOptionSelectors();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; startGameBtn.addEventListener(&#39;click&#39;, startGame);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; playAgainBtn.addEventListener(&#39;click&#39;, () =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gameOverScreen.classList.add(&#39;hidden&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; settingsScreen.classList.remove(&#39;hidden&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.querySelector(&#39;.note-button[data-note]&#39;).parentElement.addEventListener(&#39;click&#39;, handleNoteButtonClick);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; window.addEventListener(&#39;keydown&#39;, handleKeyPress);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function setupOptionSelectors() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const optionContainers = [</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;difficulty-options&#39;),</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;clef-options&#39;),</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; ];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; optionContainers.forEach(container =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; container.addEventListener(&#39;click&#39;, (e) =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (e.target.tagName === &#39;BUTTON&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [...container.children].forEach(child =&gt; child.classList.remove(&#39;selected&#39;));</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e.target.classList.add(&#39;selected&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Set default selection</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; container.children[0].classList.add(&#39;selected&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- GAME START &amp; SETUP ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function startGame() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // 1. Read settings</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameSettings = {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; difficulty: document.querySelector(&#39;#difficulty-options .selected&#39;).dataset.value,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clef: document.querySelector(&#39;#clef-options .selected&#39;).dataset.value,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // 2. Reset game state</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; score = 0;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; level = 1;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen = [];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameIsOver = false;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // 3. Set health based on difficulty</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameSettings.difficulty === &#39;easy&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; health = 5;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; health = 3;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // 4. Update UI</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; updateHUD();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; settingsScreen.classList.add(&#39;hidden&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameScreen.classList.remove(&#39;hidden&#39;);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // 5. Start game processes</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameLoopId = requestAnimationFrame(gameLoop);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; manageNoteSpawning();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- GAME LOOP ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function gameLoop() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameIsOver) return;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // Clear canvas</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; ctx.clearRect(0, 0, canvas.width, canvas.height);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // Draw elements</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; drawStaff();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; drawNotes();</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; // Update elements</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; moveNotes();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; checkNotes();</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameLoopId = requestAnimationFrame(gameLoop);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- DRAWING FUNCTIONS ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function drawStaff() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffHeight = 10; // distance between lines</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffWidth = canvas.width - 40;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffX = 20;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffCenterY = canvas.height / 2;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const drawSingleStaff = (y_center) =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillStyle = &#39;#4a5568&#39;; // gray-600</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = -2; i &lt;= 2; i++) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillRect(staffX, y_center + i * staffHeight, staffWidth, 2);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const drawClef = (clefChar, x, y) =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillStyle = &#39;#1a202c&#39;; // gray-800</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.font = &#39;90px serif&#39;; // A large serif font for the clef symbols</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.textAlign = &#39;center&#39;;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.textBaseline = &#39;middle&#39;;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillText(clefChar, x, y);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; drawSingleStaff(staffCenterY);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameSettings.clef === &#39;treble&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drawClef(&#39;&#119070;&#39;, 45, staffCenterY); // Unicode for G-clef (Treble)</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; } else if (gameSettings.clef === &#39;bass&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drawClef(&#39;&#119074;&#39;, 45, staffCenterY); // Unicode for F-clef (Bass)</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function drawNotes() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.forEach(note =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillStyle = &#39;#1a202c&#39;; // gray-800</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.beginPath();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.ellipse(note.x, note.y, 10, 7, 0, 0, 2 * Math.PI);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fill();</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Draw leger lines if necessary</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const staffInfo = getStaffInfoForNote(note.name);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!staffInfo) return;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { staffCenterY, lineSpacing } = staffInfo;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const topStaffLineY = staffCenterY - 2 * lineSpacing;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const bottomStaffLineY = staffCenterY + 2 * lineSpacing;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (note.y &lt; topStaffLineY - lineSpacing/2) { // Above staff</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let y = topStaffLineY - lineSpacing; y &gt;= note.y; y -= lineSpacing) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillRect(note.x - 15, y, 30, 2);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (note.y &gt; bottomStaffLineY + lineSpacing/2) { // Below staff</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let y = bottomStaffLineY + lineSpacing; y &lt;= note.y; y += lineSpacing) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillRect(note.x - 15, y, 30, 2);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- NOTE MANAGEMENT ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function manageNoteSpawning() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; clearInterval(noteSpawnInterval);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const spawn = () =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (gameSettings.difficulty === &#39;easy&#39; &amp;&amp; notesOnScreen.length &lt; 1) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spawnNote();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (gameSettings.difficulty === &#39;medium&#39; &amp;&amp; level &lt; 5 &amp;&amp; notesOnScreen.length &lt; 1) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spawnNote();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (gameSettings.difficulty === &#39;medium&#39; &amp;&amp; level &gt;= 5 &amp;&amp; notesOnScreen.length &lt; 2) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spawnNote();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameSettings.difficulty === &#39;hard&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; noteSpawnInterval = setInterval(spawnNote, 2000); // Continuous scroll</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spawn(); // Initial spawn for easy/medium</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function spawnNote() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const noteName = getRandomNote();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffInfo = getStaffInfoForNote(noteName);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (!staffInfo) return; </span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const note = {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: noteName,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x: canvas.width,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y: staffInfo.yPos,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speed: calculateNoteSpeed()</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.push(note);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function moveNotes() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.forEach(note =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; note.x -= note.speed;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function checkNotes() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const notesToRemove = [];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.forEach((note, index) =&gt; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (note.x &lt; 80) { // Increased clef area to prevent notes from hitting it</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notesToRemove.push(index);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loseHealth();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; for (let i = notesToRemove.length - 1; i &gt;= 0; i--) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.splice(notesToRemove[i], 1);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (notesToRemove.length &gt; 0 &amp;&amp; gameSettings.difficulty !== &#39;hard&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; manageNoteSpawning();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- PLAYER INPUT ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function handleNoteButtonClick(e) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (e.target.matches(&#39;.note-button&#39;)) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const noteName = e.target.dataset.note;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; checkAnswer(noteName);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function handleKeyPress(e) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const key = e.key.toUpperCase();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if ([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;].includes(key)) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; checkAnswer(key);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function checkAnswer(guess) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameIsOver || notesOnScreen.length === 0) return;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const targetNote = notesOnScreen[0];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (guess === targetNote.name.charAt(0)) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; score++;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.shift(); </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; checkForLevelUp();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; updateHUD();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (gameSettings.difficulty !== &#39;hard&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; manageNoteSpawning();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loseHealth();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- GAME LOGIC &amp; RULES ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function loseHealth() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (gameIsOver) return;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; health--;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; updateHUD();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (health &lt;= 0) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; endGame();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function checkForLevelUp() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (score &gt; 0 &amp;&amp; score % 10 === 0) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; level++;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const newSpeed = calculateNoteSpeed();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; notesOnScreen.forEach(note =&gt; note.speed = newSpeed);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (level % 5 === 0) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; score += 5;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (level % 10 === 0) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; health++;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(gameSettings.difficulty === &#39;medium&#39; &amp;&amp; level &gt;= 5) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; manageNoteSpawning();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function endGame() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameIsOver = true;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; cancelAnimationFrame(gameLoopId);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; clearInterval(noteSpawnInterval);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;final-score&#39;).textContent = score;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;final-level&#39;).textContent = level;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameScreen.classList.add(&#39;hidden&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; gameOverScreen.classList.remove(&#39;hidden&#39;);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; // --- UTILITY &amp; HELPER FUNCTIONS ---</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function updateHUD() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;score&#39;).textContent = score;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;level&#39;).textContent = level;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;health&#39;).textContent = health;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function calculateNoteSpeed() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const baseTime = 10; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const timeReduction = 0.1; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const timeForLevel = baseTime * (1 - (level - 1) * timeReduction);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const effectiveTime = Math.max(timeForLevel, 1.5); </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; return (canvas.width - 80) / (effectiveTime * 60); </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function getStaffInfoForNote(noteName) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const lineSpacing = 10;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const position = notePositions[noteName];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (position === undefined) return null;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const staffCenterY = canvas.height / 2;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const bottomLineY = staffCenterY + 2 * lineSpacing;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const yPos = bottomLineY - position * (lineSpacing / 2);</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; return {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; staffCenterY: staffCenterY,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lineSpacing: lineSpacing,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yPos: yPos</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function getNoteRange() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const { clef } = gameSettings;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; let start, end;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (clef === &#39;treble&#39;) {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = &#39;C4&#39;; end = &#39;B4&#39;;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; } else { // Bass</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start = &#39;C3&#39;; end = &#39;B3&#39;;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const startIndex = allNotes.indexOf(start);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const endIndex = allNotes.indexOf(end);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; return allNotes.slice(startIndex, endIndex + 1);</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; function getRandomNote() {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; const availableNotes = getNoteRange();</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; if (availableNotes.length === 0) return &#39;C4&#39;; // Fallback</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; return availableNotes[Math.floor(Math.random() * availableNotes.length)];</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &lt;/script&gt;</span></p><p class="c0"><span class="c2">&lt;/body&gt;</span></p><p class="c0"><span class="c2">&lt;/html&gt;</span></p></body></html>